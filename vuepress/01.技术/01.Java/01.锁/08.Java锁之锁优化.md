---
title: Java锁之锁优化
date: 2021-01-16 20:03:45
permalink: /pages/9f0917/
categories:
tags:
  - 锁
---

# Java锁之锁优化

锁优化分为两种，一种是JVM开发团队对锁的优化，这个对应用开发人员来讲，一般不需要关心。另一种是应用开发人员需要关注的锁优化，这属于开发素养的范畴。

<!-- more -->
## 减少锁持有时间

只在有线程安全要求的程序上加锁。

## 减小锁粒度

将大对象（这个对象可能会被很多线程访问），拆成小对象，增加并行度，降低锁竞争。降低了锁的竞争，偏向锁，轻量级锁成功率才会提高。

最典型的减小锁粒度的案例就是 ConcurrentHashMap 的实现。

## 锁分离

最常见的锁分离就是读写锁 ReadWriteLock，根据功能进行分离成读锁和写锁，
这样读读不互斥，读写互斥，写写互斥，即保证了线程安全，又提高了性能。

读写分离思想可以延伸，只要操作互不影响，锁就可以分离。比如LinkedBlockingQueue 从头部取出，从尾部放入数据。

## 锁粗化

通常情况下，为了保证多线程间的有效并发，会要求每个线程持有锁的时间尽量短，即在使用完公共资源后，应该立即释放锁。

但是，如果一系列的连续操作都对同一个对象反复加锁，甚至枷锁操作在循环体内，频繁进行互斥的同步操作也会导致不必要的性能损耗，这种情况则可以对整个大操作，必须在循环外部加锁。
锁粗化就是扩大锁的作用域。

## 锁消除

锁消除是在编译器级别的事情。在即时编译器时，如果发现不可能被共享的对象，则可以消除这些对象的锁操作，多数是因为程序员编码不规范引起的。


<Vssue />