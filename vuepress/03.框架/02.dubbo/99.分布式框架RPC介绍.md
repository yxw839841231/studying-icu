---
title: 分布式框架——RPC介绍
date: 2021-06-15 15:04:14
permalink: /pages/80cbe6/
categories:
tags:
  - RPC
---

# 什么是 RPC

## 什么是 RPC

RPC（Remote Procedure Call）远程过程调用，即本地调用了远程机器上的某个方法。

![本地调用和远程调用的区别](https://cdn.jsdelivr.net/gh/yxw839841231/images/studying-icu/20210615150625.png)

## RPC框架的目的

本地调用的时候，写一个方法，就可以任意调用，可以说是随心所欲。但远程机器上的方法是不可控的，RPC框架的目的就是让调用远程机器上的方法如同调用本地方法那么简单随意。

## 如何设计一个 RPC 框架

### 服务消费者

作为服务消费者，首先需要面向接口编程，因为远程服务都只会暴露接口，那么首先就需要知道有哪些接口可用，即接口列表。这个可以通过公共 jar 包来提供，通过发布不同版本来维护接口列表。

我们都知道，只有接口没有实现，方法是不能执行的，这个时候框架就需要代理来实现具体的接口。

虽然代理能为服务消费者解决具体实现的问题，但代理依然需要知道去哪台服务器上执行方法，因此需要一个注册中心，告知代理有哪些服务提供者。

同时因为一般而言，分布式都不太会使单机部署，服务提供方集群部署的情况下，调用方需要通过负载均衡来确认调用具体服务。

对于服务消费者，有了框架床提供的代理，就需要告诉代理具体执行那个接口方法，以及对应的入参。

除了这些，还要考虑容错、通信协议、序列化等等。

### 服务提供者

作为服务提供者，首要任务就是实现具体的接口，否则提供个寂寞？

实现了具体的接口，还要将接口暴露给注册中心，这让服务消费者才能选择是否调用。

当接受到消费者的调用请求后，要正确的反序列化请求，然后将请求添加到线程池中处理。工作线程正确处理请求后，再将处理结果原路返回。

### 注册中心

服务消费者和提供者，需要依赖注册中心才能正常通信，配置中心还能将配置集中化处理，动态变更通知订阅者。常见的比如 Nacos、Consul 等。
